# 使用輕量級的 Python 3.9 環境
FROM python:3.9-slim

# 設定容器內的工作目錄
WORKDIR /app

# 先複製 requirements.txt 以利用 Docker 快取層
COPY requirements.txt .

# 安裝 Python 相依套件
RUN pip install --no-cache-dir -r requirements.txt

# 複製剩餘的程式碼 (server.py)
COPY . .

# 設定環境變數：讓 Python log 直接輸出 (對 Cloud Logging 很重要)
ENV PYTHONUNBUFFERED=1

# Cloud Run 會注入 PORT 環境變數，這裡預設為 8080
ENV PORT=8080

# 使用 Gunicorn 啟動伺服器 (Production 建議設定)
# server:app 代表執行 server.py 裡的 app 物件
CMD exec gunicorn --bind :$PORT --workers 1 --threads 8 --timeout 0 server:app